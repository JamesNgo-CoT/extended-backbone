{"version":3,"file":"extended-backbone.min.js","sources":["extended-backbone.js"],"sourcesContent":["\"use strict\";\n\nvar _routes;\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n/* global _ $ Backbone CotForm */\n\n/* exported ExtendedBackboneCollection */\nvar ExtendedBackboneCollection = Backbone.Collection.extend({\n  parse: function parse(response, options) {\n    return Backbone.Collection.prototype.parse.call(this, response && response.value ? response.value : response, options);\n  },\n  fetch: function fetch() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    var query = _.result(this, 'query');\n\n    if (query || options.query) {\n      var _query = Object.assign({}, _query, options.query);\n\n      var urlError = function urlError() {\n        throw new Error('A \"url\" property or function must be specified');\n      };\n\n      var base = _.result(this, 'url') || urlError();\n\n      if (_typeof(_query) === 'object') {\n        _query = Object.keys(_query).map(function (key) {\n          return \"\".concat(encodeURIComponent(key), \"=\").concat(encodeURIComponent(_query[key]));\n        }).join('&');\n      }\n\n      options.url = \"\".concat(base, \"?\").concat(_query);\n    }\n\n    return Backbone.Collection.prototype.fetch.call(this, options);\n  }\n});\n/* exported ExtendedBackboneModel */\n\nvar ExtendedBackboneModel = Backbone.Model.extend({\n  url: function url() {\n    var urlError = function urlError() {\n      throw new Error('A \"url\" property or function must be specified');\n    };\n\n    var base = _.result(this, 'urlRoot') || _.result(this.collection, 'url') || urlError();\n\n    if (this.isNew()) {\n      return base;\n    }\n\n    var id = this.get(this.idAttribute);\n    return \"\".concat(base.replace(/\\/$/, ''), \"('\").concat(encodeURIComponent(id), \"')\");\n  },\n  save: function save(key, val, options) {\n    var attrs;\n\n    if (key == null || _typeof(key) === 'object') {\n      attrs = key;\n      options = val;\n    } else {\n      (attrs = {})[key] = val;\n    }\n\n    options = options || {};\n\n    if (!options.attrsInclusive) {\n      attrs = Object.assign({}, this.attributes, attrs);\n    }\n\n    delete attrs['@odata.etag'];\n    delete attrs['__CreatedOn'];\n    delete attrs['__ModifiedOn'];\n    delete attrs['__Owner'];\n    options.data = JSON.stringify(attrs);\n    return Backbone.Model.prototype.save.call(this, null, options);\n  }\n});\n/* exported ExtendedBackboneRouter */\n\nvar ExtendedBackboneRouter = Backbone.Router.extend({\n  defaultFragment: 'home',\n  routes: (_routes = {}, _defineProperty(_routes, 'home', function home() {}), _defineProperty(_routes, '*default', 'routeDefault'), _routes),\n  execute: function execute(callback, args, name) {\n    var _this = this;\n\n    var nextCleanup = function nextCleanup(cleanupFunction) {\n      if (typeof cleanupFunction === 'function') {\n        _this.cleanupFunction = cleanupFunction;\n      }\n    };\n\n    var afterCleanup = function afterCleanup(cleanupFunctionReturnValue) {\n      if (cleanupFunctionReturnValue !== false) {\n        _this.cleanupFunction = null;\n\n        if (typeof callback === 'function') {\n          var cleanupFunction = callback.call.apply(callback, [_this].concat(_toConsumableArray(args)));\n\n          if (cleanupFunction instanceof Promise) {\n            cleanupFunction.then(function (finalCleanupFunction) {\n              nextCleanup(finalCleanupFunction);\n            });\n          } else {\n            nextCleanup(cleanupFunction);\n          }\n        }\n      } else {\n        if (_this.routeDefault) {\n          _this.routeDefault();\n        }\n      }\n    };\n\n    var cleanupFunctionReturnValue;\n\n    if (this.cleanupFunction) {\n      cleanupFunctionReturnValue = this.cleanupFunction.call(this, name);\n    }\n\n    if (cleanupFunctionReturnValue instanceof Promise) {\n      cleanupFunctionReturnValue.then(function (finalCleanupFunctionReturnValue) {\n        afterCleanup(finalCleanupFunctionReturnValue);\n      });\n    } else {\n      afterCleanup(cleanupFunctionReturnValue);\n    }\n  },\n  route: function route(_route, name, callback) {\n    var oldCallback;\n\n    if (callback) {\n      oldCallback = callback;\n    } else if (name) {\n      if (typeof name === 'function') {\n        oldCallback = name;\n      } else if (typeof name === 'string') {\n        oldCallback = this[name];\n      }\n    }\n\n    if (oldCallback && (!this.routeDefault || oldCallback !== this.routeDefault)) {\n      var newCallback = function newCallback() {\n        var _oldCallback;\n\n        this.lastFragment = Backbone.history.getFragment();\n\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        return (_oldCallback = oldCallback).call.apply(_oldCallback, [this].concat(args));\n      };\n\n      if (callback) {\n        callback = newCallback;\n      } else if (name) {\n        if (typeof name === 'function') {\n          name = newCallback;\n        } else if (typeof name === 'string') {\n          this[name] = newCallback;\n        }\n      }\n    }\n\n    return Backbone.Router.prototype.route.call(this, _route, name, callback);\n  },\n  routeDefault: function routeDefault() {\n    if (this.lastFragment != null) {\n      this.navigate(this.lastFragment, {\n        trigger: false,\n        replace: true\n      });\n    } else if (this.defaultFragment != null) {\n      this.navigate(this.defaultFragment, {\n        trigger: true\n      });\n    }\n  }\n});\n/* exported FormBackboneView */\n\nvar FormBackboneView = Backbone.View.extend({\n  formDefinition: function formDefinition() {\n    var _this2 = this;\n\n    return {\n      id: _.result(this, 'formId'),\n      rootPath: _.result(this, 'rootPath'),\n      success: function success(event) {\n        event.preventDefault();\n\n        _this2.trigger('success');\n\n        return false;\n      },\n      useBinding: true,\n      sections: _.result(this, 'section')\n    };\n  },\n  formScript: function formScript() {},\n  render: function render() {\n    this.$el.empty();\n    var cotForm = new CotForm(this.formDefinition());\n    cotForm.render({\n      target: this.$el\n    });\n    cotForm.setModel(this.model);\n    this.$form = $('form', this.$el).eq(0);\n    this.formValidator = this.$form.data('formValidation');\n    this.$liveRegion = $('.js-aria-live.sr-only, .ui-helper-hidden-accessible').eq(0);\n    this.formScript();\n  },\n  disableFields: function disableFields() {\n    this.$disabledElements = this.$form.find('button, input, select').filter(':enabled:visible').prop('disabled', true);\n    this.$liveRegion.html('Form fields are disabled');\n  },\n  enableFields: function enableFields() {\n    if (this.$disabledElements) {\n      this.$disabledElements.prop('disabled', false);\n      this.$disabledElements = null;\n    }\n\n    this.$liveRegion.html('Form fields are enabled');\n  },\n  showError: function showError(message) {\n    this.$form.prepend(\"\\n      <div role=\\\"alert\\\" class=\\\"alert alert-danger alert-dismissible\\\">\\n        <button type=\\\"button\\\" data-dismiss=\\\"alert\\\" aria-label=\\\"Close\\\" class=\\\"close\\\">\\n          <span aria-hidden=\\\"true\\\">\\xD7</span>\\n        </button>\\n        <div>\\n            <strong>\".concat(message, \"</strong>\\n        </div>\\n      </div>\\n    \"));\n  }\n});"],"names":["_routes","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","o","minLen","_arrayLikeToArray","n","Object","prototype","toString","call","slice","constructor","name","Array","from","test","iter","Symbol","iterator","isArray","len","length","i","arr2","_defineProperty","obj","key","value","defineProperty","enumerable","configurable","writable","_typeof","ExtendedBackboneCollection","Backbone","Collection","extend","parse","response","options","this","fetch","_query","base","arguments","undefined","_","result","query","assign","Error","urlError","keys","map","concat","encodeURIComponent","join","url","ExtendedBackboneModel","Model","collection","isNew","id","get","idAttribute","replace","save","val","attrs","attrsInclusive","attributes","data","JSON","stringify","ExtendedBackboneRouter","Router","defaultFragment","routes","execute","callback","args","nextCleanup","cleanupFunction","_this","afterCleanup","cleanupFunctionReturnValue","apply","Promise","then","finalCleanupFunction","routeDefault","finalCleanupFunctionReturnValue","route","_route","oldCallback","newCallback","lastFragment","history","getFragment","_len","_key","navigate","trigger","FormBackboneView","View","formDefinition","_this2","rootPath","success","event","preventDefault","useBinding","sections","formScript","render","$el","empty","cotForm","CotForm","target","setModel","model","$form","$","eq","formValidator","$liveRegion","disableFields","$disabledElements","find","filter","prop","html","enableFields","showError","message","prepend"],"mappings":"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"}